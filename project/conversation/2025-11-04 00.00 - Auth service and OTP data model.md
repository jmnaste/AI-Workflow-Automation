# Conversation — Auth service and OTP data model

## What the user asked

- Rename NetShell service to `netshell` and keep docs accurate
- Ensure API can make outbound requests and optionally expose public webhooks via Traefik
- Add a new `auth` container project mirroring `api` (DB, private by default, optional webhooks)
- Clarify DATABASE_URL (DSN) configuration for `api` and `auth` on Hostinger
- Discuss URL path style (e.g., `/api/...` vs no prefix) and routing implications
- Confirm webhook uniqueness strategy across services (hosts vs paths)
- Decide OTP login approach with Twilio on a trial account (no Verify service), plus data model
- Define roles (user/admin/super), forgiving attempts, UUID IDs, retention policy for OTP entries
- Centralize configurable parameters (attempts/rate, token/session lifecycles)
- Many-to-many users↔tenants, provider‑agnostic tenants for MS365/Google and future
- Migration approach to allow fresh DB bootstrap via migrations only

## Assistant’s response and actions

- Renamed NetShell compose service to `netshell` and updated NetShell README references
- Kept API private by default; added env‑controlled Traefik labels to optionally expose webhook routes with TLS
- Added `/api/egress/health` endpoint to validate outbound internet access
- Scaffolded `auth/` service (health, DB health, egress checks), compose, README, and GHCR workflow
- Documented DSN setup for `api` and `auth` (same‑network and external Postgres examples)
- Clarified that prefixes like `/api/` and `/auth/` are optional; host or path routing both viable
- Explained safe webhook naming: unique by host or path (or secret segments)
- Designed custom SMS OTP flow using Twilio Messaging API (no Verify), with rate limits and security notes
- Proposed SQL schema: `users` (with `created_by`, roles), `otp_challenges`, `sessions`, `tenants`, `users_tenants`, optional `login_audit`, `rate_limits`
- Introduced `settings` table for configurable parameters (OTP TTL/attempts, rate limits, token/session lifecycles)
- Cleanup strategy: cancel/expire on attempts, and periodic hard delete of old OTP challenges
- Migration plan with Alembic: initial base migration, additive revisions, clean bootstrap via `upgrade head`

---

Generated on 2025-11-04.